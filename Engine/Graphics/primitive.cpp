// system/graphics/primitive.cpp
#include "primitive.h"
#include "texture_loader.h"

namespace Engine {
    static ID3D11ShaderResourceView* g_pDefaultTexture = nullptr;

    Vertex3D BoxVertices[36] = {
        // 前面 (Z = -0.5)
        {{-0.5f,  0.5f, -0.5f}, {0, 0, -1}, {1, 1, 1, 1}, {0, 0}},
        {{ 0.5f,  0.5f, -0.5f}, {0, 0, -1}, {1, 1, 1, 1}, {1, 0}},
        {{-0.5f, -0.5f, -0.5f}, {0, 0, -1}, {1, 1, 1, 1}, {0, 1}},
        {{-0.5f, -0.5f, -0.5f}, {0, 0, -1}, {1, 1, 1, 1}, {0, 1}},
        {{ 0.5f,  0.5f, -0.5f}, {0, 0, -1}, {1, 1, 1, 1}, {1, 0}},
        {{ 0.5f, -0.5f, -0.5f}, {0, 0, -1}, {1, 1, 1, 1}, {1, 1}},
        // 背面 (Z = 0.5)
        {{ 0.5f,  0.5f,  0.5f}, {0, 0, 1}, {1, 1, 1, 1}, {0, 0}},
        {{-0.5f,  0.5f,  0.5f}, {0, 0, 1}, {1, 1, 1, 1}, {1, 0}},
        {{ 0.5f, -0.5f,  0.5f}, {0, 0, 1}, {1, 1, 1, 1}, {0, 1}},
        {{ 0.5f, -0.5f,  0.5f}, {0, 0, 1}, {1, 1, 1, 1}, {0, 1}},
        {{-0.5f,  0.5f,  0.5f}, {0, 0, 1}, {1, 1, 1, 1}, {1, 0}},
        {{-0.5f, -0.5f,  0.5f}, {0, 0, 1}, {1, 1, 1, 1}, {1, 1}},
        // 左面 (X = -0.5)
        {{-0.5f,  0.5f,  0.5f}, {-1, 0, 0}, {1, 1, 1, 1}, {0, 0}},
        {{-0.5f,  0.5f, -0.5f}, {-1, 0, 0}, {1, 1, 1, 1}, {1, 0}},
        {{-0.5f, -0.5f,  0.5f}, {-1, 0, 0}, {1, 1, 1, 1}, {0, 1}},
        {{-0.5f, -0.5f,  0.5f}, {-1, 0, 0}, {1, 1, 1, 1}, {0, 1}},
        {{-0.5f,  0.5f, -0.5f}, {-1, 0, 0}, {1, 1, 1, 1}, {1, 0}},
        {{-0.5f, -0.5f, -0.5f}, {-1, 0, 0}, {1, 1, 1, 1}, {1, 1}},
        // 右面 (X = 0.5)
        {{ 0.5f,  0.5f, -0.5f}, {1, 0, 0}, {1, 1, 1, 1}, {0, 0}},
        {{ 0.5f,  0.5f,  0.5f}, {1, 0, 0}, {1, 1, 1, 1}, {1, 0}},
        {{ 0.5f, -0.5f, -0.5f}, {1, 0, 0}, {1, 1, 1, 1}, {0, 1}},
        {{ 0.5f, -0.5f, -0.5f}, {1, 0, 0}, {1, 1, 1, 1}, {0, 1}},
        {{ 0.5f,  0.5f,  0.5f}, {1, 0, 0}, {1, 1, 1, 1}, {1, 0}},
        {{ 0.5f, -0.5f,  0.5f}, {1, 0, 0}, {1, 1, 1, 1}, {1, 1}},
        // 上面 (Y = 0.5)
        {{-0.5f,  0.5f,  0.5f}, {0, 1, 0}, {1, 1, 1, 1}, {0, 0}},
        {{ 0.5f,  0.5f,  0.5f}, {0, 1, 0}, {1, 1, 1, 1}, {1, 0}},
        {{-0.5f,  0.5f, -0.5f}, {0, 1, 0}, {1, 1, 1, 1}, {0, 1}},
        {{-0.5f,  0.5f, -0.5f}, {0, 1, 0}, {1, 1, 1, 1}, {0, 1}},
        {{ 0.5f,  0.5f,  0.5f}, {0, 1, 0}, {1, 1, 1, 1}, {1, 0}},
        {{ 0.5f,  0.5f, -0.5f}, {0, 1, 0}, {1, 1, 1, 1}, {1, 1}},
        // 下面 (Y = -0.5)
        {{-0.5f, -0.5f, -0.5f}, {0, -1, 0}, {1, 1, 1, 1}, {0, 0}},
        {{ 0.5f, -0.5f, -0.5f}, {0, -1, 0}, {1, 1, 1, 1}, {1, 0}},
        {{-0.5f, -0.5f,  0.5f}, {0, -1, 0}, {1, 1, 1, 1}, {0, 1}},
        {{-0.5f, -0.5f,  0.5f}, {0, -1, 0}, {1, 1, 1, 1}, {0, 1}},
        {{ 0.5f, -0.5f, -0.5f}, {0, -1, 0}, {1, 1, 1, 1}, {1, 0}},
        {{ 0.5f, -0.5f,  0.5f}, {0, -1, 0}, {1, 1, 1, 1}, {1, 1}},
    };

    void InitPrimitives(ID3D11Device* pDevice) {
        g_pDefaultTexture = TextureLoader::Load(pDevice, L"resource/texture/white.png");
        if (!g_pDefaultTexture) {
            g_pDefaultTexture = TextureLoader::CreateWhite(pDevice);
        }
    }

    void UninitPrimitives() {
        if (g_pDefaultTexture) {
            g_pDefaultTexture->Release();
            g_pDefaultTexture = nullptr;
        }
    }

    ID3D11ShaderResourceView* GetDefaultTexture() {
        return g_pDefaultTexture;
    }
}

// グローバル公開用
Engine::Vertex3D Box[36];

// 静的初期化でコピー
namespace {
    struct BoxInitializer {
        BoxInitializer() {
            memcpy(Box, Engine::BoxVertices, sizeof(Box));
        }
    } g_boxInit;
}
